(function(){function F(){}function J(a){this.buttonBar=m.getElementById("wmd-button-bar"+a);this.preview=m.getElementById("wmd-preview"+a);this.input=m.getElementById(a)}function K(a,b){var d=this,c=[],e=0,l="none",i,p,h,g=function(k,s){if(l!=k){l=k;s||t()}if(!x.isIE||l!="moving")p=setTimeout(n,1);else h=null},n=function(k){h=new G(b,k);p=undefined};this.setCommandMode=function(){l="command";t();p=setTimeout(n,0)};this.canUndo=function(){return e>1};this.canRedo=function(){if(c[e+1])return true;return false};
this.undo=function(){if(d.canUndo())if(i){i.restore();i=null}else{c[e]=new G(b);c[--e].restore();a&&a()}l="none";b.input.focus();n()};this.redo=function(){if(d.canRedo()){c[++e].restore();a&&a()}l="none";b.input.focus();n()};var t=function(){var k=h||new G(b);if(!k)return false;if(l=="moving")i||(i=k);else{if(i){if(c[e-1].text!=i.text)c[e++]=i;i=null}c[e++]=k;c[e+1]=null;a&&a()}},o=function(k){var s=false;if(k.ctrlKey||k.metaKey)switch(String.fromCharCode(k.charCode||k.keyCode)){case "y":d.redo();
s=true;break;case "z":k.shiftKey?d.redo():d.undo();s=true;break}if(s){k.preventDefault&&k.preventDefault();if(window.event)window.event.returnValue=false}},A=function(k){if(!k.ctrlKey&&!k.metaKey){k=k.keyCode;if(k>=33&&k<=40||k>=63232&&k<=63235)g("moving");else if(k==8||k==46||k==127)g("deleting");else if(k==13)g("newlines");else if(k==27)g("escape");else if((k<16||k>20)&&k!=91)g("typing")}},f=function(){r.addEvent(b.input,"keypress",function(s){if((s.ctrlKey||s.metaKey)&&(s.keyCode==89||s.keyCode==
90))s.preventDefault()});var k=function(){if(x.isIE||h&&h.text!=b.input.value)if(p==undefined){l="paste";t();n()}};r.addEvent(b.input,"keydown",o);r.addEvent(b.input,"keydown",A);r.addEvent(b.input,"mousedown",function(){g("moving")});b.input.onpaste=k;b.input.ondrop=k};(function(){f();n(true);t()})()}function G(a,b){var d=this,c=a.input;this.init=function(){if(r.isVisible(c))if(!(!b&&m.activeElement&&m.activeElement!==c)){this.setInputAreaSelectionStartEnd();this.scrollTop=c.scrollTop;if(!this.text&&
c.selectionStart||c.selectionStart===0)this.text=c.value}};this.setInputAreaSelection=function(){if(r.isVisible(c))if(c.selectionStart!==undefined&&!x.isOpera){c.focus();c.selectionStart=d.start;c.selectionEnd=d.end;c.scrollTop=d.scrollTop}else if(m.selection)if(!(m.activeElement&&m.activeElement!==c)){c.focus();var e=c.createTextRange();e.moveStart("character",-c.value.length);e.moveEnd("character",-c.value.length);e.moveEnd("character",d.end);e.moveStart("character",d.start);e.select()}};this.setInputAreaSelectionStartEnd=
function(){if(!a.ieCachedRange&&(c.selectionStart||c.selectionStart===0)){d.start=c.selectionStart;d.end=c.selectionEnd}else if(m.selection){d.text=r.fixEolChars(c.value);var e=a.ieCachedRange||m.selection.createRange(),l=r.fixEolChars(e.text),i="\u0007"+l+"\u0007";e.text=i;var p=r.fixEolChars(c.value);e.moveStart("character",-i.length);e.text=l;d.start=p.indexOf("\u0007");d.end=p.lastIndexOf("\u0007")-1;if(i=d.text.length-r.fixEolChars(c.value).length){for(e.moveStart("character",-l.length);i--;){l+=
"\n";d.end+=1}e.text=l}if(a.ieCachedRange)d.scrollTop=a.ieCachedScrollTop;a.ieCachedRange=null;this.setInputAreaSelection()}};this.restore=function(){if(d.text!=undefined&&d.text!=c.value)c.value=d.text;this.setInputAreaSelection();c.scrollTop=d.scrollTop};this.getChunks=function(){var e=new F;e.before=r.fixEolChars(d.text.substring(0,d.start));e.startTag="";e.selection=r.fixEolChars(d.text.substring(d.start,d.end));e.endTag="";e.after=r.fixEolChars(d.text.substring(d.end));e.scrollTop=d.scrollTop;
return e};this.setChunks=function(e){e.before+=e.startTag;e.after=e.endTag+e.after;this.start=e.before.length;this.end=e.before.length+e.selection.length;this.text=e.before+e.selection+e.after;this.scrollTop=e.scrollTop};this.init()}function L(a,b,d){var c,e,l,i=function(j,q){r.addEvent(j,"input",q);j.onpaste=q;j.ondrop=q;r.addEvent(j,"keypress",q);r.addEvent(j,"keydown",q)},p=function(){var j=0;if(window.innerHeight)j=window.pageYOffset;else if(m.documentElement&&m.documentElement.scrollTop)j=m.documentElement.scrollTop;
else if(m.body)j=m.body.scrollTop;return j},h=function(){if(b.preview){var j=b.input.value;if(!(j&&j==l)){l=j;var q=(new Date).getTime();j=a.makeHtml(j);e=(new Date).getTime()-q;w(j)}}},g=function(){if(c){clearTimeout(c);c=undefined}if("delayed"!=="manual"){var j=0;if("delayed"==="delayed")j=e;if(j>3E3)j=3E3;c=setTimeout(h,j)}},n=function(j){if(j.scrollHeight<=j.clientHeight)return 1;return j.scrollTop/(j.scrollHeight-j.clientHeight)},t=function(){if(b.preview)b.preview.scrollTop=(b.preview.scrollHeight-
b.preview.clientHeight)*n(b.preview)};this.refresh=function(j){if(j){l="";h()}else g()};this.processingTime=function(){return e};var o=true,A=function(j){var q=b.preview,B=q.parentNode,C=q.nextSibling;B.removeChild(q);q.innerHTML=j;C?B.insertBefore(q,C):B.appendChild(q)},f=function(j){b.preview.innerHTML=j},k,s=function(j){if(k)return k(j);try{f(j);k=f}catch(q){k=A;k(j)}},w=function(j){var q=z.getTop(b.input)-p();if(b.preview){s(j);d()}t();if(o)o=false;else{var B=z.getTop(b.input)-p();x.isIE?setTimeout(function(){window.scrollBy(0,
B-q)},0):window.scrollBy(0,B-q)}};(function(){i(b.input,g);h();if(b.preview)b.preview.scrollTop=0})()}function M(a,b,d,c,e,l){function i(f){t.focus();if(f.textOp){d&&d.setCommandMode();var k=new G(b);if(!k)return;var s=k.getChunks(),w=function(){t.focus();s&&k.setChunks(s);k.restore();c.refresh()};f.textOp(s,w)||w()}f.execute&&f.execute(d)}function p(f,k){var s=f.getElementsByTagName("span")[0];if(k){s.style.backgroundPosition=f.XShift+" 0px";f.onmouseover=function(){s.style.backgroundPosition=this.XShift+
" -40px"};f.onmouseout=function(){s.style.backgroundPosition=this.XShift+" 0px"};if(x.isIE)f.onmousedown=function(){if(!(m.activeElement&&m.activeElement!==b.input)){b.ieCachedRange=document.selection.createRange();b.ieCachedScrollTop=b.input.scrollTop}};if(!f.isHelp)f.onclick=function(){this.onmouseout&&this.onmouseout();i(this);return false}}else{s.style.backgroundPosition=f.XShift+" -20px";f.onmouseover=f.onmouseout=f.onclick=function(){}}}function h(f){if(typeof f==="string")f=e[f];return function(){f.apply(e,
arguments)}}function g(){var f=b.buttonBar,k=document.createElement("ul");k.id="wmd-button-row"+a;k.className="wmd-button-row";k=f.appendChild(k);var s=0;f=function(j,q,B,C){var y=document.createElement("li");y.className="wmd-button";y.style.left=s+"px";s+=25;var N=document.createElement("span");y.id=j+a;y.appendChild(N);y.title=q;y.XShift=B;if(C)y.textOp=C;p(y,true);k.appendChild(y);return y};var w=function(j){var q=document.createElement("li");q.className="wmd-spacer wmd-spacer"+j;q.id="wmd-spacer"+
j+a;k.appendChild(q);s+=25};o.bold=f("wmd-bold-button","Strong <strong> Ctrl+B","0px",h("doBold"));o.italic=f("wmd-italic-button","Emphasis <em> Ctrl+I","-20px",h("doItalic"));w(1);o.link=f("wmd-link-button","Hyperlink <a> Ctrl+L","-40px",h(function(j,q){return this.doLinkOrImage(j,q,false)}));o.quote=f("wmd-quote-button","Blockquote <blockquote> Ctrl+Q","-60px",h("doBlockquote"));o.code=f("wmd-code-button","Code Sample <pre><code> Ctrl+K","-80px",h("doCode"));o.image=f("wmd-image-button","Image <img> Ctrl+G",
"-100px",h(function(j,q){return this.doLinkOrImage(j,q,true)}));w(2);o.olist=f("wmd-olist-button","Numbered List <ol> Ctrl+O","-120px",h(function(j,q){this.doList(j,q,true)}));o.ulist=f("wmd-ulist-button","Bulleted List <ul> Ctrl+U","-140px",h(function(j,q){this.doList(j,q,false)}));o.heading=f("wmd-heading-button","Heading <h1>/<h2> Ctrl+H","-160px",h("doHeading"));o.hr=f("wmd-hr-button","Horizontal Rule <hr> Ctrl+R","-180px",h("doHorizontalRule"));if(typeof ajaxurl!="undefined"){o.more=f("wmd-more-button",
"More <hr> Ctrl+M","-260px",h("doMoreTag"));w("3-admin")}else w(3);o.undo=f("wmd-undo-button","Undo - Ctrl+Z","-200px",null);o.undo.execute=function(j){j&&j.undo()};w=/win/.test(D.platform.toLowerCase())?"Redo - Ctrl+Y":"Redo - Ctrl+Shift+Z";o.redo=f("wmd-redo-button",w,"-220px",null);o.redo.execute=function(j){j&&j.redo()};if(l){f=document.createElement("li");w=document.createElement("span");f.appendChild(w);f.className="wmd-button wmd-help-button";f.id="wmd-help-button"+a;f.XShift="-240px";f.isHelp=
true;f.style.right="0px";f.title=l.title||O;f.onclick=l.handler;p(f,true);k.appendChild(f);o.help=f}n()}function n(){if(d){p(o.undo,d.canUndo());p(o.redo,d.canRedo())}}var t=b.input,o={};g();var A="keydown";if(x.isOpera)A="keypress";r.addEvent(t,A,function(f){if((f.ctrlKey||f.metaKey)&&!f.altKey&&!f.shiftKey){switch(String.fromCharCode(f.charCode||f.keyCode).toLowerCase()){case "b":i(o.bold);break;case "i":i(o.italic);break;case "l":i(o.link);break;case "m":i(o.more);break;case "q":i(o.quote);break;
case "k":i(o.code);break;case "g":i(o.image);break;case "o":i(o.olist);break;case "u":i(o.ulist);break;case "h":i(o.heading);break;case "r":i(o.hr);break;case "y":i(o.redo);break;case "z":f.shiftKey?i(o.redo):i(o.undo);break;default:return}f.preventDefault&&f.preventDefault();if(window.event)window.event.returnValue=false}});r.addEvent(t,"keyup",function(f){if(f.shiftKey&&!f.ctrlKey&&!f.metaKey)if((f.charCode||f.keyCode)===13){f={};f.textOp=h("doAutoindent");i(f)}});x.isIE&&r.addEvent(t,"keydown",
function(f){if(f.keyCode===27)return false});this.setUndoRedoButtonStates=n}function I(a){this.hooks=a}function P(a){return a.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(b,d,c){d=d.replace(/\?.*$/,function(e){return e.replace(/\+/g," ")});d=decodeURIComponent(d);d=encodeURI(d).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");d=d.replace(/\?.*$/,function(e){return e.replace(/\+/g,"%2b")});if(c){c=c.trim?c.trim():c.replace(/^\s*/,"").replace(/\s*$/,"");c=$.trim(c).replace(/"/g,"quot;").replace(/\(/g,
"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return c?d+' "'+c+'"':d})}var r={},z={},E={},m=window.document,v=window.RegExp,D=window.navigator,H={lineLength:72},x={isIE:/msie/.test(D.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(D.userAgent.toLowerCase())||/msie 5/.test(D.userAgent.toLowerCase()),isOpera:/opera/.test(D.userAgent.toLowerCase())},O="Markdown Editing Help";Markdown.Editor=function(a,b,d){b=b||"";var c=this.hooks=new Markdown.HookCollection;c.addNoop("onPreviewRefresh");
c.addNoop("postBlockquoteCreation");c.addFalse("insertImageDialog");this.getConverter=function(){return a};var e=this,l;this.run=function(){if(!l){l=new J(b);var i=new I(c),p=new L(a,l,function(){c.onPreviewRefresh()}),h,g;/\?noundo/.test(m.location.href)||(h=new K(function(){p.refresh();g&&g.setUndoRedoButtonStates()},l));g=new M(b,l,h,p,i,d);g.setUndoRedoButtonStates();(e.refreshPreview=function(){p.refresh(true)})()}}};F.prototype.findTags=function(a,b){var d=this,c;if(a){c=r.extendRegExp(a,"",
"$");this.before=this.before.replace(c,function(e){d.startTag+=e;return""});c=r.extendRegExp(a,"^","");this.selection=this.selection.replace(c,function(e){d.startTag+=e;return""})}if(b){c=r.extendRegExp(b,"","$");this.selection=this.selection.replace(c,function(e){d.endTag=e+d.endTag;return""});c=r.extendRegExp(b,"^","");this.after=this.after.replace(c,function(e){d.endTag=e+d.endTag;return""})}};F.prototype.trimWhitespace=function(a){var b,d=this;if(a)a=b="";else{a=function(c){d.before+=c;return""};
b=function(c){d.after=c+d.after;return""}}this.selection=this.selection.replace(/^(\s*)/,a).replace(/(\s*)$/,b)};F.prototype.skipLines=function(a,b,d){if(a===undefined)a=1;if(b===undefined)b=1;a++;b++;var c,e;navigator.userAgent.match(/Chrome/)&&"X".match(/()./);this.selection=this.selection.replace(/(^\n*)/,"");this.startTag+=v.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag+=v.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before+=v.$1;this.endTag=this.endTag.replace(/(\n*$)/,
"");this.after+=v.$1;if(this.before){for(c=e="";a--;){c+="\\n?";e+="\n"}if(d)c="\\n*";this.before=this.before.replace(new v(c+"$",""),e)}if(this.after){for(c=e="";b--;){c+="\\n?";e+="\n"}if(d)c="\\n*";this.after=this.after.replace(new v(c,""),e)}};r.isVisible=function(a){if(window.getComputedStyle)return window.getComputedStyle(a,null).getPropertyValue("display")!=="none";else if(a.currentStyle)return a.currentStyle.display!=="none"};r.addEvent=function(a,b,d){a.attachEvent?a.attachEvent("on"+b,d):
a.addEventListener(b,d,false)};r.removeEvent=function(a,b,d){a.detachEvent?a.detachEvent("on"+b,d):a.removeEventListener(b,d,false)};r.fixEolChars=function(a){a=a.replace(/\r\n/g,"\n");return a=a.replace(/\r/g,"\n")};r.extendRegExp=function(a,b,d){if(b===null||b===undefined)b="";if(d===null||d===undefined)d="";a=a.toString();var c;a=a.replace(/\/([gim]*)$/,function(e,l){c=l;return""});a=a.replace(/(^\/|\/$)/g,"");a=b+a+d;return new v(a,c)};z.getTop=function(a,b){var d=a.offsetTop;if(!b)for(;a=a.offsetParent;)d+=
a.offsetTop;return d};z.getHeight=function(a){return a.offsetHeight||a.scrollHeight};z.getWidth=function(a){return a.offsetWidth||a.scrollWidth};z.getPageSize=function(){var a,b,d,c;if(self.innerHeight&&self.scrollMaxY){a=m.body.scrollWidth;b=self.innerHeight+self.scrollMaxY}else if(m.body.scrollHeight>m.body.offsetHeight){a=m.body.scrollWidth;b=m.body.scrollHeight}else{a=m.body.offsetWidth;b=m.body.offsetHeight}if(self.innerHeight){d=self.innerWidth;c=self.innerHeight}else if(m.documentElement&&
m.documentElement.clientHeight){d=m.documentElement.clientWidth;c=m.documentElement.clientHeight}else if(m.body){d=m.body.clientWidth;c=m.body.clientHeight}a=Math.max(a,d);b=Math.max(b,c);return[a,b,d,c]};E.createBackground=function(){var a=m.createElement("div"),b=a.style;a.className="wmd-prompt-background";b.position="absolute";b.top="0";b.zIndex="1000";if(x.isIE)b.filter="alpha(opacity=50)";else b.opacity="0.5";var d=z.getPageSize();b.height=d[1]+"px";if(x.isIE){b.left=m.documentElement.scrollLeft;
b.width=m.documentElement.clientWidth}else{b.left="0";b.width="100%"}m.body.appendChild(a);return a};E.prompt=function(a,b,d){var c,e;if(b===undefined)b="";var l=function(h){(h.charCode||h.keyCode)===27&&i(true)},i=function(h){r.removeEvent(m.body,"keydown",l);var g=e.value;if(h)g=null;else{g=g.replace(/^http:\/\/(https?|ftp):\/\//,"$1://");/^(?:https?|ftp):\/\//.test(g)||(g="http://"+g)}c.parentNode.removeChild(c);d(g);return false},p=function(){c=m.createElement("div");c.className="wmd-prompt-dialog";
c.style.padding="10px;";c.style.position="fixed";c.style.width="400px";c.style.zIndex="1001";var h=m.createElement("div");h.innerHTML=a;h.style.padding="5px";c.appendChild(h);h=m.createElement("form");var g=h.style;h.onsubmit=function(){return i(false)};g.padding="0";g.margin="0";g.cssFloat="left";g.width="100%";g.textAlign="center";g.position="relative";c.appendChild(h);e=m.createElement("input");e.type="text";e.value=b;g=e.style;g.display="block";g.width="80%";g.marginLeft=g.marginRight="auto";
h.appendChild(e);var n=m.createElement("input");n.type="button";n.onclick=function(){return i(false)};n.value="OK";g=n.style;g.margin="10px";g.display="inline";g.width="7em";var t=m.createElement("input");t.type="button";t.onclick=function(){return i(true)};t.value="Cancel";g=t.style;g.margin="10px";g.display="inline";g.width="7em";h.appendChild(n);h.appendChild(t);r.addEvent(m.body,"keydown",l);c.style.top="50%";c.style.left="50%";c.style.display="block";if(x.isIE_5or6){c.style.position="absolute";
c.style.top=m.documentElement.scrollTop+200+"px";c.style.left="50%"}m.body.appendChild(c);c.style.marginTop=-(z.getHeight(c)/2)+"px";c.style.marginLeft=-(z.getWidth(c)/2)+"px"};setTimeout(function(){p();var h=b.length;if(e.selectionStart!==undefined){e.selectionStart=0;e.selectionEnd=h}else if(e.createTextRange){var g=e.createTextRange();g.collapse(false);g.moveStart("character",-h);g.moveEnd("character",h);g.select()}e.focus()},0)};var u=I.prototype;u.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";
u.unwrap=function(a){var b=new v("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");a.selection=a.selection.replace(b,"$1 $2")};u.wrap=function(a,b){this.unwrap(a);b=new v("(.{1,"+b+"})( +|$\\n?)","gm");var d=this;a.selection=a.selection.replace(b,function(c,e){if((new v("^"+d.prefixes,"")).test(c))return c;return e+"\n"});a.selection=a.selection.replace(/\s+$/,"")};u.doBold=function(a,b){return this.doBorI(a,b,2,"strong text")};u.doItalic=function(a,b){return this.doBorI(a,b,1,"emphasized text")};u.doBorI=
function(a,b,d,c){a.trimWhitespace();a.selection=a.selection.replace(/\n{2,}/g,"\n");var e=/(\**$)/.exec(a.before)[0];b=/(^\**)/.exec(a.after)[0];e=Math.min(e.length,b.length);if(e>=d&&(e!=2||d!=1)){a.before=a.before.replace(v("[*]{"+d+"}$",""),"");a.after=a.after.replace(v("^[*]{"+d+"}",""),"")}else if(!a.selection&&b){a.after=a.after.replace(/^([*_]*)/,"");a.before=a.before.replace(/(\s?)$/,"");a.before=a.before+b+v.$1}else{if(!a.selection&&!b)a.selection=c;d=d<=1?"*":"**";a.before+=d;a.after=d+
a.after}};u.stripLinkDefs=function(a,b){return a=a.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(d,c,e,l,i){b[c]=d.replace(/\s*$/,"");if(l){b[c]=d.replace(/["(](.+?)[")]$/,"");return l+i}return""})};u.addLinkDef=function(a,b){var d=0,c={};a.before=this.stripLinkDefs(a.before,c);a.selection=this.stripLinkDefs(a.selection,c);a.after=this.stripLinkDefs(a.after,c);var e="",l=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,
i=function(h){d++;h=h.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+d+"]:");e+="\n"+h},p=function(h,g,n,t,o,A){n=n.replace(l,p);if(c[o]){i(c[o]);return g+n+t+d+A}return h};a.before=a.before.replace(l,p);if(b)i(b);else a.selection=a.selection.replace(l,p);b=d;a.after=a.after.replace(l,p);if(a.after)a.after=a.after.replace(/\n*$/,"");if(!a.after)a.selection=a.selection.replace(/\n*$/,"");a.after+="\n\n"+e;return b};u.doLinkOrImage=function(a,b,d){a.trimWhitespace();a.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);
var c;if(a.endTag.length>1&&a.startTag.length>0){a.startTag=a.startTag.replace(/!?\[/,"");a.endTag="";this.addLinkDef(a,null)}else{a.selection=a.startTag+a.selection+a.endTag;a.startTag=a.endTag="";if(/\n\n/.test(a.selection))this.addLinkDef(a,null);else{var e=this,l=function(i){c.parentNode.removeChild(c);if(i!==null){a.selection=(" "+a.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);i=" [999]: "+P(i);i=e.addLinkDef(a,i);a.startTag=d?"![":"[";a.endTag="]["+i+"]";if(!a.selection)a.selection=
d?"enter image description here":"enter link description here"}b()};c=E.createBackground();if(d)this.hooks.insertImageDialog(l)||E.prompt("<p><strong>Insert Image</strong></p><p>http://example.com/images/diagram.jpg</p>","http://",l);else E.prompt("<p><strong>Insert Hyperlink</strong></p>","http://",l);return true}}};u.doAutoindent=function(a){var b=this;a.before=a.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");a.before=a.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");a.before=
a.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(a.before)&&b.doList&&b.doList(a);/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(a.before)&&b.doBlockquote&&b.doBlockquote(a);/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&b.doCode&&b.doCode(a)};u.doBlockquote=function(a){a.selection=a.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(h,g,n,t){a.before+=g;a.after=t+a.after;return n});a.before=a.before.replace(/(>[ \t]*)$/,function(h,g){a.selection=g+a.selection;return""});a.selection=
a.selection.replace(/^(\s|>)+$/,"");a.selection=a.selection||"Blockquote";var b="",d="",c;if(a.before){for(var e=a.before.replace(/\n$/,"").split("\n"),l=false,i=0;i<e.length;i++){var p=false;c=e[i];l=l&&c.length>0;if(/^>/.test(c)){p=true;if(!l&&c.length>1)l=true}else p=/^[ \t]*$/.test(c)?true:l;if(p)b+=c+"\n";else{d+=b+c;b="\n"}}if(!/(^|\n)>/.test(b)){d+=b;b=""}}a.startTag=b;a.before=d;if(a.after)a.after=a.after.replace(/^\n?/,"\n");a.after=a.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,
function(h){a.endTag=h;return""});b=function(h){var g=h?"> ":"";if(a.startTag)a.startTag=a.startTag.replace(/\n((>|\s)*)\n$/,function(n,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,g)+"\n"});if(a.endTag)a.endTag=a.endTag.replace(/^\n((>|\s)*)\n/,function(n,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,g)+"\n"})};if(/^(?![ ]{0,3}>)/m.test(a.selection)){this.wrap(a,H.lineLength-2);a.selection=a.selection.replace(/^/gm,"> ");b(true);a.skipLines()}else{a.selection=a.selection.replace(/^[ ]{0,3}> ?/gm,
"");this.unwrap(a);b(false);if(!/^(\n|^)[ ]{0,3}>/.test(a.selection)&&a.startTag)a.startTag=a.startTag.replace(/\n{0,2}$/,"\n\n");if(!/(\n|^)[ ]{0,3}>.*$/.test(a.selection)&&a.endTag)a.endTag=a.endTag.replace(/^\n{0,2}/,"\n\n")}a.selection=this.hooks.postBlockquoteCreation(a.selection);if(!/\n/.test(a.selection))a.selection=a.selection.replace(/^(> *)/,function(h,g){a.startTag+=g;return""})};u.doCode=function(a){var b=/\S[ ]*$/.test(a.before);if(!/^[ ]*\S/.test(a.after)&&!b||/\n/.test(a.selection)){a.before=
a.before.replace(/[ ]{4}$/,function(c){a.selection=c+a.selection;return""});var d=b=1;if(/\n(\t|[ ]{4,}).*\n$/.test(a.before))b=0;if(/^\n(\t|[ ]{4,})/.test(a.after))d=0;a.skipLines(b,d);if(a.selection)a.selection=/^[ ]{0,3}\S/m.test(a.selection)?a.selection.replace(/^/gm,"    "):a.selection.replace(/^[ ]{4}/gm,"");else{a.startTag="    ";a.selection="enter code here"}}else{a.trimWhitespace();a.findTags(/`/,/`/);if(!a.startTag&&!a.endTag){a.startTag=a.endTag="`";if(!a.selection)a.selection="enter code here"}else if(a.endTag&&
!a.startTag){a.before+=a.endTag;a.endTag=""}else a.startTag=a.endTag=""}};u.doList=function(a,b,d){b=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var c="-",e=1,l=function(){var n;if(d){n=" "+e+". ";e++}else n=" "+c+" ";return n},i=function(n){if(d===undefined)d=/^\s*\d/.test(n);return n=n.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(){return l()})};a.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);if(a.before&&!/\n$/.test(a.before)&&!/^\n/.test(a.startTag)){a.before+=
a.startTag;a.startTag=""}if(a.startTag){var p=/\d+[.]/.test(a.startTag);a.startTag="";a.selection=a.selection.replace(/\n[ ]{4}/g,"\n");this.unwrap(a);a.skipLines();if(p)a.after=a.after.replace(b,i);if(d==p)return}var h=1;a.before=a.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(n){if(/^\s*([*+-])/.test(n))c=v.$1;h=/[^\n]\n\n[^\n]/.test(n)?1:0;return i(n)});if(!a.selection)a.selection="List item";p=l();var g=1;a.after=
a.after.replace(b,function(n){g=/[^\n]\n\n[^\n]/.test(n)?1:0;return i(n)});a.trimWhitespace(true);a.skipLines(h,g,true);a.startTag=p;b=p.replace(/./g," ");this.wrap(a,H.lineLength-b.length);a.selection=a.selection.replace(/\n/g,"\n"+b)};u.doHeading=function(a){a.selection=a.selection.replace(/\s+/g," ");a.selection=a.selection.replace(/(^\s+|\s+$)/g,"");if(a.selection){var b=0;a.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(a.startTag))b=v.lastMatch.length;a.startTag=a.endTag="";a.findTags(null,/\s?(-+|=+)/);
if(/=+/.test(a.endTag))b=1;if(/-+/.test(a.endTag))b=2;a.startTag=a.endTag="";a.skipLines(1,1);b=b==0?2:b-1;if(b>0){b=b>=2?"-":"=";var d=a.selection.length;if(d>H.lineLength)d=H.lineLength;for(a.endTag="\n";d--;)a.endTag+=b}}else{a.startTag="## ";a.selection="Heading";a.endTag=" ##"}};u.doHorizontalRule=function(a){a.startTag="----------\n";a.selection="";a.skipLines(2,1,true)};u.doMoreTag=function(a){a.startTag="<!--more--\>\n";a.selection="";a.skipLines(2,1,true)}})();
